---
title: "RMarkdown: верстаем красивое"
author: "Антон Ангельгардт"
date: "31.08.202"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
    toc: yes
    toc_depth: 3
    css: "style.css"
---

**RMarkdown** --- это пакет, который позволяет соединять текст, исполняемый код и результаты исполнения кода в единый документ. Это очень полезно для представления данных. На выходе мы можем получить файлы `.html`, `.pdf` --- в том числе презентации форматов `.html` и `.pdf`[^pdf_pres] --- `.docx`, `.pptx`. Более того, можно связать несколько HTML-документов и получить сайт или книгу. Ну, гениально же!

Мы сосредоточимся на HTML-документах сегодня, потому что это проще всего и, как показывает практика, полезнее всего.

[^pdf_pres]: Потребуется [Beamer](https://en.wikipedia.org/wiki/Beamer_(LaTeX))



## Установка {#installing}

> Если вдруг ещё не, надо поставить R ([Win](https://cran.r-project.org/bin/windows/base/), [Mac](https://cran.r-project.org/bin/macosx/), [Linux](https://cran.rstudio.com/bin/linux/)) и [RStudio](https://www.rstudio.com/products/rstudio/download/).

Устанавливается RMarkdown как обычный пакет:

```{r, eval=FALSE}
install.packages("rmarkdown")
```

Есть ещё пакет, который не обязательно устанавливать сразу, но он нам пригодится, чтобы делать красивое:

```{r, eval=FALSE}
install.packages("prettydoc")
```


## Структура документа {#structure}

* [YAML](https://en.wikipedia.org/wiki/YAML)-шапка
* самый обычный текст (как в блокноте) с форматированием от [Markdown](https://en.wikipedia.org/wiki/Markdown), расширенным с помощью [Pandoc](https://en.wikipedia.org/wiki/Pandoc)
* блоки [кода](#code) (в целом, на любом языке программирования)
* формулы в $\LaTeX$’e


### Чё внутри происходит? {#under-the-hood}

Кратко взглянем на то, как из `.rmd` получается `.html`.

1. Мы пишем руками `.rmd.`шку (RMarkdown).
2. Отправляем её пакету `knitr`, который выполняет чанки кода и делаем `.md`шку (Markdown).
3. Дальше `.md`шку берёт Pandoc, который есть конвертер, и делает окончательный файл, который мы пожелали --- например, `html`ку или `.pdf.`ку, призывая $\LaTeX$.


<center>
<img src="workflow.png">
</center>
<p style="float:right; font-size:10pt; margin-top:-5px">
[Источник](https://bookdown.org/yihui/rmarkdown-cookbook/rmarkdown-process.html)
</p>


### Первый `.rmd`-файл

Как создать `.rmd`шку? Надо проследовать по пути `File > New File > RMarkdown...`, оставить все настройки по умолчанию и жмакнуть `OK`.

<center>
<img src="rmd-new-doc.png">
</center>

Возникнет дефолтный `.rmd`-файл.

Его можно скомпилировать либо с помощью функции `rmarkdown::render("file.Rmd")`, либо жмакнув кнопку `Knit` вверху текстового редактора.

<center>
<img src="knit.png">
</center>

Если по дороге ничего не сломалось, то должно получиться [что-то такое](first-rmd.html).


***

<img class="task" src="code.png">

<div class="task">
Создайте и скомпилируйте дефолтный `.rmd`-файл.
</div>

***





## Markdown & Pandoc {#markdown}

* Markdown --- это универсальный язык разметки, использующийся очень много где.
* Pandoc --- конвертер файлов между различными форматами. А ещё он дает немного плюшек для форматирования ([индексы](#sub-and-superscripts), [нумерованные примеры](#numbering), [сноски](#footnotes)).



### Заголовки {#headers}

Обозначаются хэштегами, после которых надо обязательно поставить пробел, иначе получится [ссылка](#tag).

```
# Заголовок 1

## Заголовок 2

### Заголовок 3

#### Заголовок 4

##### Заголовок 5

###### Заголовок 6

```


На заголовках можно оставлять теги --- они не отображаются --- чтобы организовывать [навигацию по документу](#links):

```
# Заголовок 1 {#tag1}

## Заголовок 2 {#header2}

### Заголовок 3 {#wow_third_level_header}
```


### Форматирование {#formatting}

* *Курсив / наклон* --- `*курсив* или _курсив_`
* **Полужирный** --- `**полужирный** или __полужирный__`
* ~~Зачеркнутый~~ --- `~~зачеркнутый~~`


#### Индексы {#sub-and-superscripts}

* Нижние индексы --- CH~3~CH~2~OH --- в тильдах --- `CH~2~CH~3~OH`
* Верхние индексы --- К^+^, Cr~2~O~7~^2-^ --- в шапочках --- `К^+^, Cr~2~O~7~^2-^`



### Списки {#lists}

Есть несколько вариантов и все рабочие:

#### Ненумерованные списки

```
* овощи
    * томаты
    * все остальные
* фрукты
    * обыкновенные
        * яблоко
        * груша
    * тропические
        * папайя
        * маракуйя
* ягоды
    * удобные для сбора
    * крыжовник
```

<div class="example">
* овощи
    * томаты
    * все остальные
* фрукты
    * обыкновенные
        * яблоко
        * груша
    * тропические
        * папайя
        * маракуйя
* ягоды
    * удобные для сбора
    * крыжовник
</div>

Ещё можно плюсами и минусами пользоваться, типа вот так

```
- овощи
    + томаты
    + все остальные
- фрукты
    + обыкновенные
        - яблоко
        - груша
    + тропические
        - папайя
        - маракуйя
- ягоды
    - удобные для сбора
    - крыжовник
```

<div class="example">
- овощи
    + томаты
    + все остальные
- фрукты
    + обыкновенные
        - яблоко
        - груша
    + тропические
        - папайя
        - маракуйя
- ягоды
    - удобные для сбора
    - крыжовник
</div>

#### Нумерованные списки

```
1. рыба
   1. карп
   3. треска
   2. камбала
2. мясо
    1. всякое
    2. разное
3. ни рыба ни мясо
   1. птица
      1. кура
      4. перепёлка
   2. инопланетное непонятно что
```

<div class="example">
1. рыба
   1. карп
   3. треска
   2. камбала
2. мясо
    1. всякое
    2. разное
3. ни рыба ни мясо
   1. птица
      1. кура
      4. перепёлка
   2. инопланетное непонятно что
</div>

Смотрите, даже если мы накосячили в нумерации, при компиляции всё поправилось, и нумерация в итоговом доке верная.



### Нумерованные примеры {#numbering}

В списки можно собирать некоторые примеры:

```
(@) Парменид сказал, что «бытие есть --- небытия нет». Трудно поспорить.
(@socrates) Сократ заявил, что он «знает, что ничего не знает, но другие не знают даже этого». Ну, ок.
(@plato) Платон задвигал про мир идей.
(@aristotle) Аристотель нам основал все науки.
```

<div class="example">
(@) Парменид сказал, что «бытие есть --- небытия нет». Трудно поспорить.
(@socrates) Сократ заявил, что он «знает, что ничего не знает, но другие не знают даже этого». Ну, ок.
(@plato) Платон задвигал про мир идей.
(@aristotle) Аристотель нам основал все науки.
</div>


Во-вервых, они будут автоматически нумероваться, а во-вторых, если к ним приписать лейблы (здесь: `socrates`, `plato`, `arislotle`). Можно будет ссылаться на примеры:

```
Считается, что (@plato) записывал за (@socrates).
```

<div class="example">
Считается, что (@plato) записывал за (@socrates).
</div>




### Ссылки {#links}

Вариантов есть несколько и вот они, пожалуй, все.

```
Вставляем [ссылку](https://www.google.com/) красиво.

Или не очень красиво, но зато ясно, куда она ведет: <https://www.google.com/>.

Если хочется собрать все ссылки в одном месте, то для отображения их в тексте можно оставить [метку][1] или даже просто [метку].

А ещё если у вас есть теги на заголовках, можно ссылаться и внутрь документа, например [так](#tables).

[1]: https://www.google.com/
[метку]: https://www.google.com/

```

<div class="example">

Вставляем [ссылку](https://www.google.com/) красиво.

Или не очень красиво, но зато ясно, куда она ведет: <https://www.google.com/>.

Если хочется собрать все ссылки в одном месте, то для отображения их в тексте можно оставить [метку][1] или даже просто [метку].

[1]: https://www.google.com/
[метку]: https://www.google.com/

А ещё если у вас есть теги на заголовках, можно ссылаться и внутрь документа, например [так](#tables).

</div>





### Картинки {#pics}

Очень похожи по синтаксису на ссылки, только перед квадратными скобками надо поставить `!`,а внутри них пишется либо ничего, либо [альтернативный текст](https://en.wikipedia.org/wiki/Alt_attribute)/название картинки. В круглых скобках пишется адрес картинки.

```
![](cat.jpeg)
![Удивлённый кот Федя](https://cdnn21.img.ria.ru/images/07e5/06/18/1738448523_0:54:864:540_640x0_80_0_0_1909d455bf858de749abb1ae8dc540b7.jpg.webp)
```

<div class="example">
![](cat.jpeg)
![Удивлённый кот Федя](https://cdnn21.img.ria.ru/images/07e5/06/18/1738448523_0:54:864:540_640x0_80_0_0_1909d455bf858de749abb1ae8dc540b7.jpg.webp)
</div>

Да, прямо веб-ссылку можно впихнуть туда.

```
Метки здесь так же работают. ![][cat_shocked]

[cat_shocked]: cat_shocked.png
```

<div class="example">
Метки здесь также работают. ![][cat_shocked]

[cat_shocked]: cat_shocked.png
</div>


<font size=2>Лично я не большой фанат вставлять картинки средствами Markdown, поэтому использую HTML. Там больше возможностей кастомизации отображения.</font>





### Цитаты {#quotes}

Цитаты оформляются с помощью знака `>`:

```
> Это цитата, которая содержит глубокую философскую мысль.
> Тут мысль раскрывается --- это строка попадает в тот же фрагмент.

> А это уже _следующая_ цитата, в которой применяется __форматирование__.
>
> <p align="right">Автор цитаты</p>
```


> Это цитата, которая содержит глубокую философскую мысль.
> Тут мысль раскрывается --- это строка попадает в тот же фрагмент.

> А это уже _следующая_ цитата, в которой применяется __форматирование__.
>
> <p align="right">Автор цитаты[^align_right]</p>

[^align_right]: Здесь использован HTML-тег `p` для того, чтобы сделать выравнивание имени автора по правому краю. К сожалению, сам Markdown про выравнивание ничего не знает :(

### Разрыв страницы {#page-break}

Делается тремя звёздочками: `***`. Выглядит так:

***


### Таблицы {#tables}

Делать руками таблицы --- достаточно запарно. В общем-то, не только в Markdown, но и в HTML или $\LaTeX$ тоже. К тому же, не то чтобы нам очень часто надо делать таблицы руками. Поэтому не будем тратить на это много времени и внимания, и просто сохраним [ссылку на генератор таблиц](http://www.tablesgenerator.com/markdown_tables).



### Сноски {#footnotes}

Делаются так:

```
Это сноска[^1].
Но лучше не номером, а как-то так[^another_footnote].

[^1]: Да, это сноска.
[^another_footnote]: Да, это тоже сноска, только не по номеру, а через лейбл.
```

<div class="example">
Это сноска[^1].
Но лучше не номером, а как-то так[^another_footnote].

[^1]: Да, это сноска.
[^another_footnote]: Да, это тоже сноска, только не по номеру, а через лейбл.

</div>

Разницы, где оставлять содержание сноски, особой нет --- можно сразу после абзаца, в котором сноска даётся, можно в конце документа.

<font size=2>Я предпочитаю первый вариант, чтобы можно было следовать за содержанием документа и не прыгать по нему, если нужны исправления.</font>



***

<img class="task" src="code.png">

<div class="task">
Представим, что вам пора писать статью. Создайте шаблон для неё в RMarkdown.

Шаблон должен содержать:

- заголовки основных разделов
- пара строк текста в каждом разделе, о чем будет этот раздел
- суперважная сноска в каком-нибудь из разделов
- ссылка на какой-то внешний ресурс (например, откуда вы взяли стимульный материал)
- цитата великого ученого, на работы которого вы опираетесь
</div>

***


## HTML {#html}

Ежели вы монстр и постигли HTML, то можно прям на нём делать вставки в RMarkdown. Ну, скажем, список можно сделать и так:

```
<ul>
    <li>пункт номер раз</li>
    <li>пункт номер два</li>
    <li>пункт номер три</li>
</ul>

```

<div class="example">
<ul>
    <li>пункт номер раз</li>
    <li>пункт номер два</li>
    <li>пункт номер три</li>
</ul>
</div>


Кстати, HTML и Markdown можно комбинировать, и это будет работать:

```
Допустим,
<dl>
   <dt>__термин__</dt>
   <dd> и его определение, в котором нужно сделать _акцент_, либо <em>акцент</em>.</dd>
</dl>
```

<div class="example">
Допустим,
<dl>
   <dt>__термин__</dt>
   <dd> и его определение, в котором нужно сделать _акцент_, либо <em>акцент</em>.</dd>
</dl>
</div>


## $\LaTeX$ {#latex}

С помощью $\LaTeX$'а можно писать красивые формулы. Хорошо, конечно, если вы шарите за $\LaTeX$, но если нет, можно посмотреть 100500 примеров [тут](http://www.ccas.ru/voron/download/voron05latex.pdf).

### Сверхкраткое введение в математику в $\LaTeX$'е

* Есть формулы. Они бывают *внутритекстовые*, которые --- шок! --- идут внутри текста, и *выключные*, которые вынесены в отдельную строку.
* Внтуритекстовые формулы оформляются с помощью одинарных знаков доллара `$ formula $` примерно так:

````
Если верить тому, что $2 + 2 = 4$, то получается, что $22 + 22 = 44$.
````

<div class="example">
Если верить тому, что $2 + 2 = 4$, то получается, что $22 + 22 = 44$.
</div>

* Выключные формулы оформляются с помощью двойных знаков доллара `$$ formula $$`. Они всегда выравнены по центру.

````
Кажется, что если сложить несколько чисел и поделить на их количество, получится нечто, именуемое _средним арифметическим_:

$$
\bar x = \frac{1}{n} \sum_{i=1}^n x_i
$$
  
Будем думать, что это действительно так.
````

<div class="example">
Кажется, что если сложить несколько чисел и поделить на их количество, получится нечто, именуемое _средним арифметическим_:

$$
\bar x = \frac{1}{n} \sum_{i=1}^n x_i
$$

Будем думать, что это действительно так.
</div>


* Есть куча разных операторов-функций типа `\bar`, `\sum`, `\frac`, `\times` и др. Они позволяют вводить всякие разные математические символы. Какие они есть и как их употреблять, можно опять же смотреть [тут](http://www.ccas.ru/voron/download/voron05latex.pdf).




***

<img class="task" src="code.png">

***


## Код {#code}

Код заключается в [бэктики](backticks.html): `` `sum(1, 2, 3)` ``. Это если мы хотим код прямо в строке. Если хотим код отдельным чанком, то по три бэктика в начале и конце:

````
```
x <- c(1,3,5,7)
mean(x)
```
````

Правда такие чанки кода не исполняются. Нам такого не надо. Чтобы исполнить код при компиляции файла, надо указать, на каком языке мы написали заклинания.


### Языки программирования {#languages}

Это указывается после первых бэктиков (допустим, мы почему-то пишем на R):

````
```{r}`r ''`
x <- c(1,3,5,7)
mean(x)
```
````

```{r}
x <- c(1,3,5,7)
mean(x)
```


Можно сделать и питон:

````
```{python}`r ''`
spisok = ["where", "is", "my", "beer"]
for word in spisok:
    print(word)
```
````

```{python}
spisok = ["where", "is", "my", "beer"]
for word in spisok:
    print(word)
```









### Настройка чанков {#chunk-settings}

### Именование чанков {#chunk-naming}


***

<img class="task" src="code.png">

***


## YAML-шапка {#yaml}

### Тип аутпута {#output}

### Библиография {#bibtex}

### Оглавление {#toc}

Есть несколько атрибутов, которые позволяют задать оформление оглавления:

* `toc` --- вставлять ли оглавление финальный док
* `toc_depth` --- сколько уровней иерархии отображать в оглавлении
* `toc_float` --- должно ли оглавление все время следовать за текстом
* `collapsed` --- должно ли оглавление быть все время полностью раскрыто
* `number_sections` --- автоматическая нумерация секций
* `code_folding (hide)` --- делать ли кнопочку, показывающую/скрывающую весь код
* `theme` --- одна из Bootstrap тем
highlight: “default”, “tango”, “pygments”, “kate”, “monochrome”, “espresso”, “zenburn”, “haddock” или “textmate”


### Отображение датафреймов {#df}


***

<img class="task" src="code.png">

***


## Дизигн {#design}

### CSS {#css}

### Макеты с темами {#themes}

Мы в самом начале установили пакет `prettydoc`, который содержит в себе весьма pretty темы для RMarkdown-документов.




***

<img class="task" src="code.png">

***


## Куда заливать HTML? {#html-hosts}


## Что ещё? {#more}

Представление данных, конечно, не ограничивается RMarkdown. Вот некоторые штуки, которые также могут быть полезны:

* `bookdown` --- расширение RMarkdown для написания книг, диссера, создания перезентаций и т.д.
* `shiny` --- динамические сайты, на которых можно развернуть взамодействие с пользователем
* `flexdashboard` --- динамические дэшборды
* `posterdown` --- постеры в RMarkdown
* `pagedown` --- тут много всяких шаблонов примерно для всего (от книги, статьи и резюме до приглашения на свадьбу)
* `blogdown` --- сайты можно пилить

